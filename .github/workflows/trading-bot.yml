name: Trading Bot Daily Execution

on:
  # Run Monday-Friday at 9:30 PM UTC (4:30 PM ET) - after market close
  schedule:
    - cron: '30 21 * * 1-5'
  
  # Allow manual trigger
  workflow_dispatch:

jobs:
  trade:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run trading bot
      env:
        ALPACA_PAPER_KEY_ID: ${{ secrets.ALPACA_PAPER_KEY_ID }}
        ALPACA_PAPER_SECRET: ${{ secrets.ALPACA_PAPER_SECRET }}
        ALPACA_BASE_URL: https://paper-api.alpaca.markets
        NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        TRADING_MODE: paper
        MAX_POSITION_SIZE: 0.10
        MAX_DAILY_LOSS: 0.03
        STOP_LOSS_PCT: 0.05
        MAX_POSITIONS: 5
        LOG_LEVEL: INFO
      run: |
        python src/main.py
    
    - name: Upload logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: trading-logs-${{ github.run_number }}
        path: logs/
        retention-days: 30
